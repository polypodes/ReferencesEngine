var utilsClass = function(){
    this.fixVScrollHeight=function(){
        var pos = $('aside .scrollable').offset();
        var h = $(document).height();
        $('aside .scrollable').css("height",h-pos.top+"px")
    }
    this.fixBottomBoxHeight=function(){
        var pos = $('.new_project_wysiwyg').height();
        var h = $(document).height();
        var fh = h-(pos+170);
        $('.bottom_box').css("height",fh+"px")
    }

    this.createSampleData=function(){ 
        var projects = [{"intro":"Introduction au projet","title":"Behance Plus","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["app","behance","design"],"category":1,"cover":"uploads/files/53c91016db8ba.png","files":[{"path":"uploads/files/53ce76f4108df.png"},{"path":"uploads/files/53ce76fa9b40b.png"},{"path":"uploads/files/53ce7700d0718.png"},{"path":"uploads/files/53ce7708247d4.png"},{"path":"uploads/files/53ce770d7561f.png"},{"path":"uploads/files/53ce771217d5a.png"}],"id":2},{"intro":"Introduction au projet","title":"Portica","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","velo"],"category":2,"cover":"uploads/files/53c9103726847.png","files":[],"id":3},{"intro":"Introduction au projet","title":"Food Diary","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["food"],"category":1,"cover":"uploads/files/53c9104f3cac9.png","files":[],"id":4},{"intro":"Introduction au projet","title":"iOS Concept Watch","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["smartwatch"],"category":3,"cover":"uploads/files/53c91063112ac.png","files":[],"id":5},{"intro":"Introduction au projet","title":"Football Leagues","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","foot"],"category":1,"cover":"uploads/files/53c9108115eac.png","files":[],"id":6},{"intro":"Introduction au projet","title":"Dark Calendar App","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["calendar","dark"],"category":1,"cover":"uploads/files/53c9109e05084.png","files":[],"id":7},{"intro":"Introduction au projet","title":"Startup Framework","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["framework","app","html"],"category":3,"cover":"uploads/files/53c91202716f7.png","files":[],"id":8},{"intro":"Introduction au projet","title":"Elespacio","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["agence"],"category":2,"cover":"uploads/files/53c9121d0c458.png","files":[],"id":9},{"intro":"Introduction au projet","title":"Anker Architecture","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["architecture","batiments"],"category":2,"cover":"uploads/files/53c9122e561f8.png","files":[],"id":10},{"intro":"Introduction au projet","title":"Planet of the Apes","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["film","fwa"],"category":2,"cover":"uploads/files/53c912454c436.png","files":[],"id":11},{"intro":"Introduction au projet","title":"Narcliarska Ski Station","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","ski"],"category":2,"cover":"uploads/files/53c912591da79.png","files":[],"id":12},{"intro":"Introduction au projet","title":"Medical Center","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["refonte","medical","hopital"],"category":2,"cover":"uploads/files/53c912783949f.png","files":[],"id":13},{"intro":"Introduction au projet","title":"Golfshop App","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["golf","sport","e-commerce"],"category":1,"cover":"uploads/files/53c9129137e01.png","files":[],"id":14},{"intro":"Introduction au projet","title":"Hay App","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["ikea","mobilier"],"category":4,"cover":"uploads/files/53c912a2da4ce.png","files":[],"id":15},{"intro":"Introduction au projet","title":"ViewfindR","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["application","geoloc"],"category":4,"cover":"uploads/files/53c915d92bc9c.png","files":[],"id":16},{"intro":"Introduction au projet","title":"Riley","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["avocat","justice"],"category":2,"cover":"uploads/files/53c915ef0474d.png","files":[],"id":17},{"intro":"Introduction au projet","title":"Nature Photos","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["photos","nature"],"category":2,"cover":"uploads/files/53c915fe28fb8.png","files":[],"id":18},{"intro":"Introduction au projet","title":"Automobile Website","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","auto"],"category":2,"cover":"uploads/files/53c9161028945.png","files":[],"id":19},{"intro":"Introduction au projet","title":"Redbull Jova Remix","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","musique"],"category":2,"cover":"uploads/files/53c91624e35d9.png","files":[],"id":20},{"intro":"Introduction au projet","title":"Ralf Schmitz","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["btp","batiment"],"category":2,"cover":"uploads/files/53c916381e48a.png","files":[],"id":21},{"intro":"Introduction au projet","title":"IMDB App","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["app","films"],"category":1,"cover":"uploads/files/53c9169536b67.png","files":[],"id":22},{"intro":"Introduction au projet","title":"Hangout Presentation Website","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["webcam","video"],"category":2,"cover":"uploads/files/53c91783a9975.png","files":[],"id":23},{"intro":"Introduction au projet","title":"CallCenter","date":"24/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["call","phone","app","mobile"],"category":1,"cover":"uploads/files/53d11cad10d4c.png","files":[],"id":24},{"intro":"Introduction au projet","title":"CineTeatro","date":"24/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["theatre","branding","cdv"],"category":4,"cover":"uploads/files/53d11ceec9c54.png","files":[],"id":26},{"intro":"Introduction au projet","title":"Admin Dashboard","date":"24/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["dashboard"],"category":3,"cover":"uploads/files/53d11d09c023a.png","files":[],"id":27}];
        localStorage.setItem("_rfktor.projects",JSON.stringify(projects));
        console.log('projects created');

        var categories = {"projects":[{"id":0,"title":"Tous les projets","path":"/projects/0"},{"id":1,"title":"Applications","path":"/projects/1"},{"id":2,"title":"Sites web","path":"/projects/2"},{"id":3,"title":"Concept","path":"/projects/3"},{"id":4,"title":"Branding","path":"/projects/4"}],"books":[{"id":0,"title":"Tous les cahiers","path":"/books/0"},{"id":1,"title":"Clients","path":"/books/1"},{"id":2,"title":"Type","path":"/books/2"},{"id":3,"title":"Domaine","path":"/books/3"}]};
        localStorage.setItem("_rfktor.categories",JSON.stringify(categories));
        console.log('categories created');

        var books = [{"btitle":"Cahier de test","subtitle":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.","bottomline":"Pour [NOM DU CLIENT] fait le [DATE]","cover":"uploads/files/53ce77328526d.png","date":"date","category":1,"theme":{"id":0,"title":"Theme 1","src":"theme1"},"exported":false,"projects_a":[{"intro":"Introduction au projet","title":"Behance Plus","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["app","behance","design"],"category":1,"cover":"uploads/files/53c91016db8ba.png","files":[{"path":"uploads/files/53ce76f4108df.png","row":0,"col":0,"sizeY":1,"sizeX":4},{"path":"uploads/files/53ce76fa9b40b.png","row":3,"col":0,"sizeY":1,"sizeX":1},{"path":"uploads/files/53ce7700d0718.png","row":3,"col":1,"sizeY":2,"sizeX":3},{"path":"uploads/files/53ce7708247d4.png","row":4,"col":0,"sizeY":1,"sizeX":1},{"path":"uploads/files/53ce770d7561f.png","row":1,"col":0,"sizeY":2,"sizeX":1},{"path":"uploads/files/53ce771217d5a.png","row":1,"col":1,"sizeY":2,"sizeX":3}],"id":2,"added":true},{"intro":"Introduction au projet","title":"Portica","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","velo"],"category":2,"cover":"uploads/files/53c9103726847.png","files":[],"id":3,"added":true},{"intro":"Introduction au projet","title":"Food Diary","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["food"],"category":1,"cover":"uploads/files/53c9104f3cac9.png","files":[],"id":4,"added":true},{"intro":"Introduction au projet","title":"iOS Concept Watch","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["smartwatch"],"category":3,"cover":"uploads/files/53c91063112ac.png","files":[],"id":5,"added":true},{"intro":"Introduction au projet","title":"Football Leagues","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","foot"],"category":1,"cover":"uploads/files/53c9108115eac.png","files":[],"id":6,"added":true}],"id":1},{"btitle":"Cahier de test 2","subtitle":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.","bottomline":"Pour [NOM DU CLIENT] fait le [DATE]","cover":"uploads/files/53ce77cb8b8a6.png","date":"date","category":1,"theme":{"id":0,"title":"Theme 1","src":"theme1"},"exported":false,"projects_a":[{"intro":"Introduction au projet","title":"Portica","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","velo"],"category":2,"cover":"uploads/files/53c9103726847.png","files":[],"id":3,"added":true},{"intro":"Introduction au projet","title":"Food Diary","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["food"],"category":1,"cover":"uploads/files/53c9104f3cac9.png","files":[],"id":4,"added":true},{"intro":"Introduction au projet","title":"Football Leagues","date":"18/7/2014","desc":"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.","tags":["sport","foot"],"category":1,"cover":"uploads/files/53c9108115eac.png","files":[],"id":6,"added":true}],"id":2}];
        localStorage.setItem("_rfktor.books",JSON.stringify(books));
        console.log('books created');
    }
}

function uniqid(prefix, more_entropy) {

  if (typeof prefix === 'undefined') {
    prefix = '';
  }

  var retId;
  var formatSeed = function(seed, reqWidth) {
    seed = parseInt(seed, 10)
      .toString(16); // to hex str
    if (reqWidth < seed.length) { // so long we split
      return seed.slice(seed.length - reqWidth);
    }
    if (reqWidth > seed.length) { // so short we pad
      return Array(1 + (reqWidth - seed.length))
        .join('0') + seed;
    }
    return seed;
  };

  // BEGIN REDUNDANT
  if (!this.php_js) {
    this.php_js = {};
  }
  // END REDUNDANT
  if (!this.php_js.uniqidSeed) { // init seed with big random int
    this.php_js.uniqidSeed = Math.floor(Math.random() * 0x75bcd15);
  }
  this.php_js.uniqidSeed++;

  retId = prefix; // start with prefix, add current milliseconds hex string
  retId += formatSeed(parseInt(new Date()
    .getTime() / 1000, 10), 8);
  retId += formatSeed(this.php_js.uniqidSeed, 5); // add seed hex string
  if (more_entropy) {
    // for more entropy we add a float lower to 10
    retId += (Math.random() * 10)
      .toFixed(8)
      .toString();
  }

  return retId;
}


var node_fs = require('fs');
var node_path = require('path');
var node_gui = require('nw.gui');
var node_win = node_gui.Window.get();
var dataPath = node_gui.App.dataPath;

node_fs.mkdirParent = function(dirPath, mode, callback) {
    node_fs.mkdir(dirPath, mode, function(error) {
    if (error && error.errno === 34) {
        node_fs.mkdirParent(path.dirname(dirPath), mode, callback);
        node_fs.mkdirParent(dirPath, mode, callback);
    }
    callback && callback(error);
  });
};

