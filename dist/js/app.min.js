Array.prototype.remove=function(e,t){var o=this.slice((t||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,o)};var utilsClass=function(){this.fixVScrollHeight=function(){var e=$("aside .scrollable").offset(),t=$(document).height();$("aside .scrollable").css("height",t-e.top+"px")}},canvasClass=function(){function e(e){var t=e.cover.width,o=e.cover.height;d=t/o;var r=t/o,a=o/t;t>c&&(t=c,o=t*a),o>l&&(o=l,t=o*r);var n=new Kinetic.Image({x:0,y:0,image:e.cover,width:t,height:o,name:"image"});i.add(n),addAnchor(i,0,0,"topLeft"),addAnchor(i,t,0,"topRight"),addAnchor(i,t,o,"bottomRight"),addAnchor(i,0,o,"bottomLeft")}this.ctx=null,loadImages=function(e,t){var o={},i=0,r=0;for(var a in e)r++;for(var a in e)o[a]=new Image,o[a].onload=function(){++i>=r&&t(o)},o[a].src=e[a]},update=function(e){var t=e.getParent(),o=t.find(".topLeft")[0],i=t.find(".topRight")[0],r=t.find(".bottomRight")[0],a=t.find(".bottomLeft")[0],n=t.find(".image")[0],s=e.x(),c=e.y();switch(e.name()){case"topLeft":i.y(c),a.x(s);break;case"topRight":o.y(c),r.x(s);break;case"bottomRight":a.y(c),i.x(s);break;case"bottomLeft":r.y(c),o.x(s)}n.setPosition(o.getPosition());var l=i.x()-o.x(),d=a.y()-o.y();l&&d&&n.setSize({width:l,height:d})},addAnchor=function(e,t,o,i){var r=(e.getStage(),e.getLayer()),a=new Kinetic.Circle({x:t,y:o,stroke:"#666",fill:"#ddd",strokeWidth:2,radius:8,name:i,draggable:!0,dragOnTop:!1});a.on("dragmove",function(){update(this),r.draw()}),a.on("mousedown touchstart",function(){e.setDraggable(!1)}),a.on("dragend",function(){e.setDraggable(!0),r.draw()}),a.on("mouseover",function(){var e=this.getLayer();document.body.style.cursor="pointer",this.setStrokeWidth(4),e.draw()}),a.on("mouseout",function(){var e=this.getLayer();document.body.style.cursor="default",this.strokeWidth(2),e.draw()}),e.add(a)};var t=null,o=null,i=null,r=null,a=null,n=null,s=1.41428571,c=500,l=500*s,d=null;this.initStage=function(s){o=new Kinetic.Stage({container:"canvas",width:c,height:l});var d=new Kinetic.Rect({x:0,y:0,width:500,height:710,fill:"#FFFFFF"});i=new Kinetic.Group({x:0,y:0,draggable:!0}),r=new Kinetic.Group({x:10,y:40,draggable:!0}),a=new Kinetic.Group({x:10,y:110,draggable:!0}),n=new Kinetic.Group({x:10,y:650,draggable:!0}),t=new Kinetic.Layer,t.add(d),t.add(i),t.add(r),t.add(a),t.add(n),o.add(t),e(s),o.draw()};var u={x:20,y:20};this.addText=function(e,o,i){r.removeChildren(),a.removeChildren(),n.removeChildren();var s=new Kinetic.Text({x:u.x,y:u.y,text:e.text,fontSize:e.fontsize,fontFamily:e.fontfamily,fill:e.color,fontStyle:"300"}),c=new Kinetic.Text({x:u.x,y:u.y,text:o.text,fontSize:o.fontsize,fontFamily:o.fontfamily,fill:o.color,fontStyle:"300",lineHeight:1.5}),l=new Kinetic.Text({x:u.x,y:u.y,text:i.text,fontSize:i.fontsize,fontFamily:i.fontfamily,fill:i.color,fontStyle:"300"});r.add(s),a.add(c),n.add(l),t.draw()},this.addImage=function(o){console.log("addimage"),i.removeChildren(),loadImages({cover:o},function(o){e(o),t.draw()})},this.exportCover=function(){o.toDataURL({callback:function(e){window.open(e)}})},this.sources={cover:"src/images/sample.jpg"};loadImages(this.sources,this.initStage)},utils=new utilsClass,App=angular.module("App",["ngRoute","ui.sortable"]);App.factory("Projects",function(){var e="Lorem ipsum dolor sit amet, consectetur adipisicing elit. Totam nulla labore ea placeat accusamus, quae quasi tenetur neque, a nostrum consectetur illo corporis fuga odit, amet. Aut nam deserunt qui?",t=[{id:0,intro:"Projet web",title:"Le Grand Débat",date:"Juillet 2014",books_count:"1",desc:e,tags:["webdesign","css","nantes","open-source"],category:1},{id:1,intro:"Projet web",title:"Auran",date:"Juillet 2014",books_count:"1",desc:e,tags:["open-source"],category:1},{id:2,intro:"Projet web",title:"Bagybag",date:"Juillet 2014",books_count:"1",desc:e,tags:["css","nantes","open-source"],category:2},{id:3,intro:"Projet web",title:"NFI",date:"Juillet 2014",books_count:"5",desc:e,tags:["webdesign","html","css","nantes","open-source"],category:2},{id:4,intro:"Projet web",title:"NFI refonte",date:"Juin 2014",books_count:"5",desc:e,tags:["webdesign","html","open-source"],category:1},{id:5,intro:"Print",title:"Brochure Magasin",date:"Juillet 2014",books_count:"1",desc:e,tags:["webdesign","css","nantes","open-source"],category:0},{id:6,intro:"Projet web",title:"Rénovation intranet",date:"Juillet 2014",books_count:"1",desc:e,tags:["open-source"],category:1},{id:7,intro:"Projet web",title:"Site e-cigarette",date:"Juillet 2014",books_count:"1",desc:e,tags:["css","nantes","open-source"],category:0}];return{get:function(e){if(null!=e){var o=[];for(var i in t)t[i].category==e&&o.push(t[i])}else o=t;return o},get_by_id:function(e){for(var o in t)if(t[o].id==e)return t[o]}}}),App.factory("Books",function(){var e=[{id:0,title:"Références e-commerce",date:"Juillet 2014",category:0},{id:1,title:"Nantes métropole",date:"Juillet 2014",category:1},{id:2,title:"Lorem impsum dolor",date:"Juillet 2014",category:2},{id:3,title:"Architecture & bâtiment",date:"Juillet 2014",category:0}];return{get:function(t){if(null!=t){var o=[];for(var i in e)e[i].category==t&&o.push(e[i])}else o=e;return o},get_by_id:function(){return{test:"test"}}}}),App.factory("Categories",function(){return{get:function(){var e={projects:[{title:"Tous les projets",path:"/projects"},{id:0,title:"Catégorie p1"},{id:1,title:"Catégorie p2"},{id:2,title:"Catégorie p3"}],books:[{title:"Tous les cahiers",path:"/books"},{id:0,title:"Catégorie b1"},{id:1,title:"Catégorie b2"},{id:2,title:"Catégorie b3"}]};for(var t in e)for(var o in e[t])null!=e[t][o].id&&(e[t][o].path="/"+t+"/"+e[t][o].id);return e}}}),App.factory("Themes",function(){return{get:function(){var e=[{id:0,title:"Theme 1",src:"theme1"},{id:1,title:"Theme 2",src:"theme2"},{id:2,title:"Theme 3",src:"theme3"},{id:3,title:"Theme 4",src:"theme4"}];return e}}}),App.factory("navService",function(){var e="overview";return{getProperty:function(){return e},setProperty:function(t){e=t}}}),App.directive("focusOn",function(){return function(e,t,o){e.$on(o.focusOn,function(){setTimeout(function(){t[0].focus()},1)})}}),App.config(["$routeProvider",function(e){e.when("/project/:project_id",{templateUrl:"src/views/project_add.html",controller:"AddProjectCtrl"}).when("/projects/:project_id?",{templateUrl:"src/views/projects.html",controller:"ProjectsCtrl"}).when("/books",{templateUrl:"src/views/books.html",controller:"BooksCtrl"}).when("/books/:book_id?",{templateUrl:"src/views/books.html",controller:"BooksCtrl"}).when("/add_project",{templateUrl:"src/views/project_add.html",controller:"AddProjectCtrl"}).when("/add_book",{templateUrl:"src/views/book_add.html",controller:"AddBookCtrl"}).when("/overview",{templateUrl:"src/views/overview.html",controller:"OverviewCtrl"}).otherwise({redirectTo:"/overview"})}]),App.controller("NavCtrl",["$scope","$location","Categories",function(e,t,o){e.pageTitle="",e.mainItems=[{path:"/overview",title:"Vue d'ensemble"},{path:"/settings",title:"Réglages"}],e.addItems=[{path:"/add_project",title:"Ajouter un projet"},{path:"/add_book",title:"Ajouter un cahier"}],e.projectsItems=[{path:"/projects",title:"Tous les projets"},{path:"/projects/1",title:"Catégorie 1"},{path:"/projects/2",title:"Catégorie 2"},{path:"/projects/3",title:"Catégorie 3"}],e.booksItems=[{path:"/books",title:"Tous les cahiers"},{path:"/books/1",title:"Catégorie 1"},{path:"/books/2",title:"Catégorie 2"},{path:"/books/3",title:"Catégorie 3"}],e.categoriesItems=o.get(),e.isActive=function(o){return o.path==t.path()?(e.pageTitle=o.title,!0):!1},e.$on("$locationChangeStart",function(){}),e.$on("$locationChangeSuccess",function(){}),e.inputCategory={project:"",book:""},e.addProjectCategory=function(t){if(13===t.which||"click"==t.type&&""!=e.inputCategory.project){var o=0;for(var i in e.categoriesItems.projects)"function"!=typeof e.categoriesItems.projects[i]&&(o=e.categoriesItems.projects[i].id);e.categoriesItems.projects.push({id:parseInt(o)+1,title:e.inputCategory.project,path:"/projects/"+(parseInt(o)+1)}),e.inputCategory.project=""}},e.addBookCategory=function(t){if(13===t.which||"click"==t.type&&""!=e.inputCategory.book){var o=0;for(var i in e.categoriesItems.books)"function"!=typeof e.categoriesItems.books[i]&&(o=e.categoriesItems.books[i].id);e.categoriesItems.books.push({id:parseInt(o)+1,title:e.inputCategory.book,path:"/books/"+(parseInt(o)+1)}),e.inputCategory.book=""}}}]),App.controller("AddBookCtrl",["$scope","Projects","Themes","$http",function(e,t,o,i){e.pageTitle="Ajouter un cahier",utils.fixVScrollHeight();var r=t.get();for(var a in r)r[a].added=!1;e.projects=r,e.projects_a=[],e.presentation_type={my_projects:"block",all_projects:"block"},e.themes=o.get(),e.theme_a={},e.changePresentation=function(t,o){"my_projects"==o?e.presentation_type.my_projects=t:"all_projects"==o&&(e.presentation_type.all_projects=t)},e.addToList=function(t){if(e.projects[t].added){e.projects[t].added=!1;for(var o in e.projects_a)e.projects_a[o].id==e.projects[t].id&&(o==e.openedSlide&&(e.openedSlide="couv"),e.projects_a.remove(o))}else e.projects[t].added=!0,e.projects_a.push(e.projects[t])},e.openedSlide="couv",e.openDetails=function(t){e.openedSlide=t},e.sortableOptions={axis:"y"},e.book={},e.couv_state={},e.chooseTheme=function(t){e.theme_a=e.themes[t]},e.bookInfoKeypress=function(){void 0!=e.book.btitle&&void 0!=e.book.image&&""!=e.book.btitle&&""!=e.book.image&&("coverEditor"!=e.couv_state.a4&&(e.couv_state.a4="generated"),e.couv_state.pres="generated",e.couv_state.web="generated")},e.previewBook=function(){var t={book:{couv:e.book,couv_state:e.couv_state,theme:e.theme_a},slides:e.projects_a};i({method:"POST",url:"templating/generate_json.php",data:$.param({data:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},e.openEditor=function(){$("link.template").attr("href","src/templates/"+e.theme_a.src+".css"),e.show_editor=!0}}]),App.controller("BooksCtrl",["$scope","Books","navService","$routeParams",function(e,t,o,i){e.books=t.get(i.book_id)}]),App.controller("ProjectsCtrl",["$scope","Projects","$routeParams",function(e,t,o){e.projects=t.get(o.project_id)}]),App.controller("AddProjectCtrl",["$scope","Projects","$routeParams",function(e,t,o){e.project_data={intro:"Introduction au projet",title:"Titre du projet",date:"date",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem."},void 0!=o.project_id&&(e.project_data=t.get_by_id(o.project_id)),e.projects=t.get(),e.live_edit={intro:!1,name:!1,date:!1,desc:!1},e.liveEdit=function(t){console.log(e.project_data),"intro"==t?e.live_edit.intro=!e.live_edit.intro:"name"==t?e.live_edit.name=!e.live_edit.name:"date"==t?e.live_edit.date=!e.live_edit.date:"desc"==t&&(e.live_edit.desc=!e.live_edit.desc),e.$broadcast("live_edit_event."+t)}}]),App.controller("OverviewCtrl",["$scope","Projects",function(e){e.pageTitle="Vue d'ensemble",$("canvas#consultations").attr("width",$(".top .graph").width()-40);{var t=document.getElementById("consultations").getContext("2d"),o={labels:["08/07","09/07","10/07","11/07","12/07","13/07","14/07","15/07"],datasets:[{label:"Consultations",fillColor:"rgba(101,208,186,0.15)",strokeColor:"rgba(101,208,186,1)",pointColor:"rgba(46,179,152,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:[30,65,59,80,81,56,55,40]}]},i={scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].lineColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};new Chart(t).Line(o,i)}}]);