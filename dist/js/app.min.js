var utilsClass=function(){this.fixVScrollHeight=function(){var e=$("aside .scrollable").offset(),t=$(document).height();$("aside .scrollable").css("height",t-e.top+"px")},this.fixBottomBoxHeight=function(){var e=$(".new_project_wysiwyg").height(),t=$(document).height(),i=t-(e+170);$(".bottom_box").css("height",i+"px")},this.createSampleData=function(){var e=[{intro:"Introduction au projet",title:"Behance Plus",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["app","behance","design"],category:1,cover:"uploads/files/53c91016db8ba.png",files:[],id:2},{intro:"Introduction au projet",title:"Portica",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["sport","velo"],category:2,cover:"uploads/files/53c9103726847.png",files:[],id:3},{intro:"Introduction au projet",title:"Food Diary",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["food"],category:1,cover:"uploads/files/53c9104f3cac9.png",files:[],id:4},{intro:"Introduction au projet",title:"iOS Concept Watch",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["smartwatch"],category:3,cover:"uploads/files/53c91063112ac.png",files:[],id:5},{intro:"Introduction au projet",title:"Football Leagues",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["sport","foot"],category:1,cover:"uploads/files/53c9108115eac.png",files:[],id:6},{intro:"Introduction au projet",title:"Dark Calendar App",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["calendar","dark"],category:1,cover:"uploads/files/53c9109e05084.png",files:[],id:7},{intro:"Introduction au projet",title:"Startup Framework",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["framework","app","html"],category:3,cover:"uploads/files/53c91202716f7.png",files:[],id:8},{intro:"Introduction au projet",title:"Elespacio",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["agence"],category:2,cover:"uploads/files/53c9121d0c458.png",files:[],id:9},{intro:"Introduction au projet",title:"Anker Architecture",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["architecture","batiments"],category:2,cover:"uploads/files/53c9122e561f8.png",files:[],id:10},{intro:"Introduction au projet",title:"Planet of the Apes",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["film","fwa"],category:2,cover:"uploads/files/53c912454c436.png",files:[],id:11},{intro:"Introduction au projet",title:"Narcliarska Ski Station",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["sport","ski"],category:2,cover:"uploads/files/53c912591da79.png",files:[],id:12},{intro:"Introduction au projet",title:"Medical Center",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["refonte","medical","hopital"],category:2,cover:"uploads/files/53c912783949f.png",files:[],id:13},{intro:"Introduction au projet",title:"Golfshop App",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["golf","sport","e-commerce"],category:1,cover:"uploads/files/53c9129137e01.png",files:[],id:14},{intro:"Introduction au projet",title:"Hay App",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["ikea","mobilier"],category:4,cover:"uploads/files/53c912a2da4ce.png",files:[],id:15},{intro:"Introduction au projet",title:"ViewfindR",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["application","geoloc"],category:4,cover:"uploads/files/53c915d92bc9c.png",files:[],id:16},{intro:"Introduction au projet",title:"Riley",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["avocat","justice"],category:2,cover:"uploads/files/53c915ef0474d.png",files:[],id:17},{intro:"Introduction au projet",title:"Nature Photos",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["photos","nature"],category:2,cover:"uploads/files/53c915fe28fb8.png",files:[],id:18},{intro:"Introduction au projet",title:"Automobile Website",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["sport","auto"],category:2,cover:"uploads/files/53c9161028945.png",files:[],id:19},{intro:"Introduction au projet",title:"Redbull Jova Remix",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["sport","musique"],category:2,cover:"uploads/files/53c91624e35d9.png",files:[],id:20},{intro:"Introduction au projet",title:"Ralf Schmitz",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["btp","batiment"],category:2,cover:"uploads/files/53c916381e48a.png",files:[],id:21},{intro:"Introduction au projet",title:"IMDB App",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["app","films"],category:1,cover:"uploads/files/53c9169536b67.png",files:[],id:22},{intro:"Introduction au projet",title:"Hangout Presentation Website",date:"18/7/2014",desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:["webcam","video"],category:2,cover:"uploads/files/53c91783a9975.png",files:[],id:23}];localStorage.setItem("_rfktor.projects",JSON.stringify(e)),console.log("projects created");var t={projects:[{id:0,title:"Tous les projets",path:"/projects/0"},{id:1,title:"Applications",path:"/projects/1"},{id:2,title:"Sites web",path:"/projects/2"},{id:3,title:"Concept",path:"/projects/3"},{id:4,title:"Branding",path:"/projects/4"}],books:[{id:0,title:"Tous les cahiers",path:"/books/0"},{id:1,title:"Clients",path:"/books/1"},{id:2,title:"Type",path:"/books/2"},{id:3,title:"Domaine",path:"/books/3"}]};localStorage.setItem("_rfktor.categories",JSON.stringify(t)),console.log("categories created");var i=[{cover:"uploads/files/53c9314992a3b.png",btitle:"Applications sociales",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:2,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[2,3,4,7,13],id:4},{cover:"uploads/files/53c931f7cf387.png",btitle:"Sites & apps cinéma",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:3,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[22,11],id:5},{cover:"uploads/files/53c932dee20b4.png",btitle:"Sites & apps sportives",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:3,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[20,19,14,12,3],id:6},{cover:"uploads/files/53c932cd11cd0.png",btitle:"Références e-commerce",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:2,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[3,4,14,19],id:7},{cover:"uploads/files/53c93340e6452.png",btitle:"Références Apple",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:1,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[8,5],id:8},{cover:"uploads/files/53c9336fdacbf.png",btitle:"Applications smartphones & tablette",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:2,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[4,6,2,14,15,22],id:9},{cover:"uploads/files/53c933929dc32.png",btitle:"Site événementiels",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:0,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[11,12,13],id:10},{cover:"uploads/files/53c933b8ee480.png",btitle:"Références Google",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",date:"date",category:0,theme:{id:0,title:"Theme 1",src:"theme1"},projects_a:[4,23],id:11}];localStorage.setItem("_rfktor.books",JSON.stringify(i)),console.log("books created")}},canvasClass=function(){function e(e){var t=e.cover.width,i=e.cover.height;u=t/i;var a=t/i,r=i/t;t>c&&(t=c,i=t*r),i>l&&(i=l,t=i*a);var s=new Kinetic.Image({x:0,y:0,image:e.cover,width:t,height:i,name:"image"});o.add(s),addAnchor(o,0,0,"topLeft"),addAnchor(o,t,0,"topRight"),addAnchor(o,t,i,"bottomRight"),addAnchor(o,0,i,"bottomLeft")}this.ctx=null,loadImages=function(e,t){var i={},o=0,a=0;for(var r in e)a++;for(var r in e)i[r]=new Image,i[r].onload=function(){++o>=a&&t(i)},i[r].src=e[r]},update=function(e){var t=e.getParent(),i=t.find(".topLeft")[0],o=t.find(".topRight")[0],a=t.find(".bottomRight")[0],r=t.find(".bottomLeft")[0],s=t.find(".image")[0],n=e.x(),c=e.y();switch(e.name()){case"topLeft":o.y(c),r.x(n);break;case"topRight":i.y(c),a.x(n);break;case"bottomRight":r.y(c),o.x(n);break;case"bottomLeft":a.y(c),i.x(n)}s.setPosition(i.getPosition());var l=o.x()-i.x(),u=r.y()-i.y();l&&u&&s.setSize({width:l,height:u})},addAnchor=function(e,t,i,o){var a=(e.getStage(),e.getLayer()),r=new Kinetic.Circle({x:t,y:i,stroke:"#666",fill:"#ddd",strokeWidth:2,radius:8,name:o,draggable:!0,dragOnTop:!1});r.on("dragmove",function(){update(this),a.draw()}),r.on("mousedown touchstart",function(){e.setDraggable(!1)}),r.on("dragend",function(){e.setDraggable(!0),a.draw()}),r.on("mouseover",function(){var e=this.getLayer();document.body.style.cursor="pointer",this.setStrokeWidth(4),e.draw()}),r.on("mouseout",function(){var e=this.getLayer();document.body.style.cursor="default",this.strokeWidth(2),e.draw()}),e.add(r)};var t=null,i=null,o=null,a=null,r=null,s=null,n=1.41428571,c=500,l=500*n,u=null;this.initStage=function(n){i=new Kinetic.Stage({container:"canvas",width:c,height:l});var u=new Kinetic.Rect({x:0,y:0,width:500,height:710,fill:"#FFFFFF"});o=new Kinetic.Group({x:0,y:0,draggable:!0}),a=new Kinetic.Group({x:10,y:40,draggable:!0}),r=new Kinetic.Group({x:10,y:110,draggable:!0}),s=new Kinetic.Group({x:10,y:650,draggable:!0}),t=new Kinetic.Layer,t.add(u),t.add(o),t.add(a),t.add(r),t.add(s),i.add(t),e(n),i.draw()};var d={x:20,y:20};this.addText=function(e,i,o){a.removeChildren(),r.removeChildren(),s.removeChildren();var n=new Kinetic.Text({x:d.x,y:d.y,text:e.text,fontSize:e.fontsize,fontFamily:e.fontfamily,fill:e.color,fontStyle:"300"}),c=new Kinetic.Text({x:d.x,y:d.y,text:i.text,fontSize:i.fontsize,fontFamily:i.fontfamily,fill:i.color,fontStyle:"300",lineHeight:1.5}),l=new Kinetic.Text({x:d.x,y:d.y,text:o.text,fontSize:o.fontsize,fontFamily:o.fontfamily,fill:o.color,fontStyle:"300"});a.add(n),r.add(c),s.add(l),t.draw()},this.addImage=function(i){console.log("addimage"),o.removeChildren(),loadImages({cover:i},function(i){e(i),t.draw()})},this.exportCover=function(){i.toDataURL({callback:function(e){window.open(e)}})},this.sources={cover:"src/images/sample.jpg"};loadImages(this.sources,this.initStage)},utils=new utilsClass,App=angular.module("App",["ngRoute","ui.sortable","LocalStorageModule","ngUpload","ngAnimate"]).config(["localStorageServiceProvider",function(e){e.setPrefix("_rfktor")}]);App.run(["$rootScope",function(e){e.notify={state:"closed",title:"title",message:"message"}}]),App.factory("Projects",["localStorageService",function(e){function t(t){null==t&&e.set("projects",[])}return{get:function(i){var o=e.get("projects");if(t(o),0!=i){var a=[];for(var r in o)o[r].category==i&&a.push(o[r])}else a=o;return a},getById:function(i){var o=e.get("projects");t(o);for(var a in o)if(o[a].id==i)return o[a]},saveLocal:function(t){e.set("projects",t)},add:function(t){var i=e.get("projects"),o=0;for(var a in i)o=i[a].id;return t.id=o+1,i.push(t),e.set("projects",i),t.id},edit:function(t,i){var o=e.get("projects");for(var a in o)o[a].id==t&&(last_id=a);o[last_id]=i,e.set("projects",o)},validate:function(e){var t=3,i=50,o=1200,a=100,r=100,s=10,n=10,c=[];return"dist/img/sample.png"==e.cover&&c.push("ajoutez une photo de couverture"),e.title.length<t&&c.push("titre trop court"),e.title.length>i&&c.push("titre trop long"),e.desc.length>o&&c.push("description trop longue"),e.intro.length>a&&c.push("introduction trop longue"),e.date.length>r&&c.push("date trop longue"),e.tags.length>s&&c.push("trop de tags (maximum "+s+")"),e.files.length>n&&c.push("trop de fichiers (maximum "+n+")"),0==c.length?!0:(c=c.join(", "),c=c.charAt(0).toUpperCase()+c.slice(1)+".")}}}]),App.factory("Books",["localStorageService",function(e){function t(t){null==t&&e.set("books",[])}return{get:function(i){var o=e.get("books");if(t(o),0!=i){var a=[];for(var r in o)o[r].category==i&&a.push(o[r])}else a=o;return a},getById:function(i){var o=e.get("books"),a=e.get("projects");t(o);var r={};for(var s in o)o[s].id==i&&(r=o[s]);var n=[],c=0;for(var l in r.projects_a){var u=r.projects_a[l];for(var d in a)a[d].id==u&&n.push(a[d]),c++}return r.projects_a=n,r},saveLocal:function(t){e.set("books",t)},add:function(t){var i=e.get("books"),o=0;for(var a in i)o=i[a].id;return t.id=o+1,i.push(t),e.set("books",i),t.id},edit:function(t,i){var o=e.get("books");for(var a in o)o[a].id==t&&(last_id=a);o[last_id]=i,e.set("books",o)},validate:function(e){var t=150,i=2,o=100,a=50,t=100,r=500,s=1,n=[];return"dist/img/sample.png"==e.cover&&n.push("ajoutez une photo de couverture"),e.btitle.length<i&&n.push("titre trop court"),e.btitle.length>o&&n.push("titre trop long"),e.projects_a.length<s&&n.push("ajoutez au moins un projet"),e.date.length>a&&n.push("date trop longue"),e.bottomline.length>t&&n.push("informations complémentaires trop longues"),e.subtitle.length>r&&n.push("description trop longue"),0==n.length?!0:(n=n.join(", "),n=n.charAt(0).toUpperCase()+n.slice(1)+".")}}}]),App.factory("Categories",["localStorageService",function(e){var t=e.get("categories");return{get:function(){for(var e in t)for(var i in t[e])null!=t[e][i].id&&(t[e][i].path="/"+e+"/"+t[e][i].id);return null==t&&(t={projects:[{id:0,title:"Tous les projets",path:"/projects/"}],books:[{id:0,title:"Tous les cahiers",path:"/books/"}]}),t},saveLocal:function(t){e.set("categories",t)}}}]),App.factory("Stats",function(){return{getForDashboard:function(){var e=new Date,t=new Date;t.setDate(t.getDate()-14);for(var i,o=[],a=[];e>=t;){i=e.getDate(),e=new Date(e.setDate(--i));var r=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();o.push(r);var s=Math.floor(301*Math.random());a.push(s)}var n={views:{web:{today:Math.floor(100*Math.random()),yesterday:Math.floor(100*Math.random()),total:Math.floor(2e3*Math.random())+2e3},pdf:{today:Math.floor(100*Math.random()),yesterday:Math.floor(100*Math.random()),total:Math.floor(2e3*Math.random())+2e3},pres:{today:Math.floor(100*Math.random()),yesterday:Math.floor(100*Math.random()),total:Math.floor(2e3*Math.random())+2e3},timeline:{labels:o,data:a}}};return n.views.total={today:n.views.web.today+n.views.pdf.today+n.views.pres.today,yesterday:n.views.web.yesterday+n.views.pdf.yesterday+n.views.pres.yesterday,total:n.views.web.total+n.views.pdf.total+n.views.pres.total},n.views.variations={growth:Math.ceil((n.views.total.today-n.views.total.yesterday)/n.views.total.yesterday*100),new_visits:n.views.total.today-n.views.total.yesterday},n}}}),App.factory("Themes",function(){return{get:function(){var e=[{id:0,title:"Theme 1",src:"theme1"},{id:1,title:"Theme 2",src:"theme2"},{id:2,title:"Theme 3",src:"theme3"},{id:3,title:"Theme 4",src:"theme4"}];return e}}}),App.factory("navService",function(){var e="overview";return{getProperty:function(){return e},setProperty:function(t){e=t}}}),App.directive("focusOn",function(){return function(e,t,i){e.$on(i.focusOn,function(){setTimeout(function(){t[0].focus()},1)})}}),App.directive("itemAnimation",function(){return function(e){e.$last&&$(".items .item").each(function(e,t){setTimeout(function(){$(t).addClass("visible")},50*e)})}}),App.directive("file",function(){return{require:"ngModel",restrict:"A",link:function(e,t){t.bind("change",function(){$("input.fileSubmit").trigger("click"),e.$apply()})}}}),App.directive("cover",function(){return{require:"ngModel",restrict:"A",link:function(e,t){t.bind("change",function(){$("input.fileSubmitCover").trigger("click"),e.$apply()})}}}),App.directive("backImg",function(){return function(e,t,i){var o=i.backImg;t.css({"background-image":"url("+o+")","background-size":"cover"})}}),App.factory("Notify",["$rootScope","$timeout",function(e,t){return e.notify="opened",function(i,o,a){function r(){t.cancel(s),s=t(function(){e.notify.state="closed"},2500)}e.notify={state:"opened",type:i,title:o,msg:a};var s;r(),$(".info-box").hover(function(){t.cancel(s)},function(){r()})}}]),App.config(["$routeProvider",function(e){e.when("/projects/:project_id?",{templateUrl:"src/views/projects.html",controller:"ProjectsCtrl"}).when("/project/:project_id?",{templateUrl:"src/views/project_add.html",controller:"AddProjectCtrl"}).when("/books/:book_id?",{templateUrl:"src/views/books.html",controller:"BooksCtrl"}).when("/book/:book_id?/edit",{templateUrl:"src/views/editor.html",controller:"BookEditorCtrl"}).when("/book/:book_id?",{templateUrl:"src/views/book_add.html",controller:"AddBookCtrl"}).when("/add_project",{templateUrl:"src/views/project_add.html",controller:"AddProjectCtrl"}).when("/add_book",{templateUrl:"src/views/book_add.html",controller:"AddBookCtrl"}).when("/overview",{templateUrl:"src/views/overview.html",controller:"OverviewCtrl"}).otherwise({redirectTo:"/overview"})}]),App.controller("NavCtrl",["$scope","$location","Categories",function(e,t,i){e.pageTitle="",e.mainItems=[{path:"/overview",title:"Vue d'ensemble",icon:"fa-tachometer"},{path:"/settings",title:"Réglages",icon:"fa-cog"}],e.addItems=[{path:"/add_project",title:"Ajouter un projet"},{path:"/add_book",title:"Ajouter un cahier"}],e.categoriesItems=i.get(),i.saveLocal(e.categoriesItems),e.isActive=function(i){return i.path==t.path()?(e.pageTitle=i.title,!0):!1},e.inputCategory={project:"",book:""},e.addProjectCategory=function(t){if(13===t.which||"click"==t.type&&""!=e.inputCategory.project){var o=0;for(var a in e.categoriesItems.projects)"function"!=typeof e.categoriesItems.projects[a]&&(o=e.categoriesItems.projects[a].id);e.categoriesItems.projects.push({id:parseInt(o)+1,title:e.inputCategory.project,path:"/projects/"+(parseInt(o)+1)}),e.inputCategory.project="",i.saveLocal(e.categoriesItems)}},e.addBookCategory=function(t){if(13===t.which||"click"==t.type&&""!=e.inputCategory.book){var o=0;for(var a in e.categoriesItems.books)"function"!=typeof e.categoriesItems.books[a]&&(o=e.categoriesItems.books[a].id);e.categoriesItems.books.push({id:parseInt(o)+1,title:e.inputCategory.book,path:"/books/"+(parseInt(o)+1)}),e.inputCategory.book="",i.saveLocal(e.categoriesItems)}},e.deleteCategory=function(t,o){"projects"==t?e.categoriesItems.projects.splice(o,1):"books"==t&&e.categoriesItems.books.splice(o,1),i.saveLocal(e.categoriesItems)}}]),App.controller("AddBookCtrl",["$scope","Projects","Themes","$http","Books","$routeParams","Notify","$location","Categories",function(e,t,i,o,a,r,s,n,c){e.pageTitle="Ajouter un cahier",utils.fixVScrollHeight();var l=t.get(0);e.categories=c.get(),e.projects=l,e.projects_a=[],e.presentation_type={my_projects:"block",all_projects:"block"},e.themes=i.get(),e.changePresentation=function(t,i){"my_projects"==i?e.presentation_type.my_projects=t:"all_projects"==i&&(e.presentation_type.all_projects=t)},e.addToList=function(t){var i=0;for(var o in e.projects)t==e.projects[o].id&&(i=o);if(e.projects[i].added){e.projects[i].added=!1;for(var o in e.projects_a)e.projects_a[o].id==e.projects[i].id&&e.projects_a.splice(o,1)}else e.projects[i].added=!0,e.projects_a.push(e.projects[i])},e.selectCategory=function(t){e.book.category=e.categories.books[t].id},e.sortableOptions={axis:"y"},e.buttonLegend="Enregistrer le cahier",void 0!=r.book_id?(e.book=a.getById(r.book_id),e.projects_a=e.book.projects_a,e.buttonLegend="Modifier le cahier"):null==r.book_id&&(e.book={cover:"",btitle:"Titre du cahier",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",cover:"dist/img/sample.png",date:"date",category:0,theme:e.themes[0]});for(var u in l)l[u].added=!1;for(var u in e.projects_a)for(var d in e.projects)e.projects_a[u].id==e.projects[d].id&&(e.projects[d].added=!0);e.chooseTheme=function(t){e.book.theme=e.themes[t]},e.chooseTheme(0),e.isUploading=!1,e.uploadImg=function(){e.isUploading=!0},e.uploadCoverComplete=function(t){e.isUploading=!1,"success"==t.status&&(e.book.cover="uploads/files/"+t.fileName)},e.saveBook=function(){var t=e.book,i=[];for(var o in e.projects_a)i.push(e.projects_a[o].id);t.projects_a=i;var c=a.validate(t);if(1!=c)return s("error","Erreur lors de l'ajout",c),!1;if(null==t.id){var l=a.add(t);s("success","Cahier ajouté","Le cahier a été ajouté à votre liste")}else if(void 0!=r.book_id){var l=t.id;a.edit(l,t),s("success","Cahier ajouté","Le cahier a été modifié avec succès")}s("success","Cahier ajouté","Le cahier a été ajouté à votre liste"),n.path("/book/"+l+"/edit")}}]),App.controller("BookEditorCtrl",["$scope","Books","navService","$routeParams","Notify",function(e,t,i,o){e.book=t.getById(o.book_id),$("link.template").attr("href","src/templates/"+e.book.theme.src+".css")}]),App.controller("BooksCtrl",["$scope","Books","navService","$routeParams","Notify","Categories",function(e,t,i,o,a,r){var s=r.get();e.cat_id=o.book_id,e.books=t.get(o.book_id),e.deleteBook=function(i){for(var o in e.books)e.books[o].id==i&&(e.books.splice(o,1),a("success","Cahier supprimé","Le cahier a été supprimé avec succès"));t.saveLocal(e.books)},e.cat_name=s.books[e.cat_id].title,e.button_rename=!1,e.toggleRenameInput=function(){e.button_rename=!e.button_rename,1==e.button_rename&&e.$broadcast("inputRenameShown")},e.changeCategoryName=function(t){(13===t.which||"click"==t.type&&""!=e.cat_name)&&(s.books[e.cat_id].title=e.cat_name,r.saveLocal(s),e.toggleRenameInput())}}]),App.controller("ProjectsCtrl",["$scope","Projects","$routeParams","Notify","Categories",function(e,t,i,o,a){var r=a.get();e.cat_id=i.project_id,e.projects=t.get(i.project_id),e.deleteProject=function(i){for(var a in e.projects)e.projects[a].id==i&&(e.projects.splice(a,1),o("success","Projet supprimé","Le projet a été supprimé avec succès"));t.saveLocal(e.projects)},e.cat_name=r.projects[e.cat_id].title,e.button_rename=!1,e.toggleRenameInput=function(){e.button_rename=!e.button_rename,1==e.button_rename&&e.$broadcast("inputRenameShown")},e.changeCategoryName=function(t){(13===t.which||"click"==t.type&&""!=e.cat_name)&&(r.projects[e.cat_id].title=e.cat_name,a.saveLocal(r),e.toggleRenameInput())}}]),App.controller("AddProjectCtrl",["$scope","Projects","Categories","$routeParams","Notify","$location",function(e,t,i,o,a,r){utils.fixBottomBoxHeight(),e.categories=i.get(),e.projects=t.get(0);var s=new Date;e.project_data={intro:"Introduction au projet",title:"Titre du projet",date:s.getDate()+"/"+(s.getMonth()+1)+"/"+s.getFullYear(),desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:[],category:0,cover:"dist/img/sample.png",files:[]},e.isUploading=!1,e.uploadImg=function(){e.isUploading=!0},void 0!=o.project_id&&(e.project_data=t.getById(o.project_id)),e.addProject=function(){var i=e.project_data,s=t.validate(i);if(1!=s)return a("error","Erreur lors de l'ajout",s),!1;null==i.id?(t.add(i),a("success","Projet ajouté","Le projet a été ajouté avec succès")):void 0!=o.project_id&&(t.edit(o.project_id,i),a("success","Projet modifié","Le projet a été modifié avec succès")),r.path("/projects/0")},e.selectCategory=function(t){e.project_data.category=e.categories.projects[t].id},e.addTag=function(t){13===t.which&&""!=e.addedTag&&(e.project_data.tags.push(e.addedTag),e.addedTag="")},e.deleteTag=function(t){return e.project_data.tags.splice(t,1),!1},e.deleteMedia=function(t){e.project_data.files.splice(t,1)},e.uploadCoverComplete=function(t){e.isUploading=!1,"success"==t.status?e.project_data.cover="uploads/files/"+t.fileName:a("error","Erreur d'upload","Image de couverture refusée, verifiez la taille et l'extension de votre fichier.")},e.uploadComplete=function(t){e.isUploading=!1,"success"==t.status?e.project_data.files.push({path:"uploads/files/"+t.fileName}):a("error","Erreur d'upload","Upload refusé, verifiez la taille et l'extension de votre fichier.")}}]),App.controller("OverviewCtrl",["$scope","Projects","Stats",function(e,t,i){e.pageTitle="Vue d'ensemble",e.stats=i.getForDashboard(),$("canvas#consultations").attr("width",$(".top .graph").width()-40);{var o=document.getElementById("consultations").getContext("2d"),a={labels:e.stats.views.timeline.labels,datasets:[{label:"Consultations",fillColor:"rgba(101,208,186,0.15)",strokeColor:"rgba(101,208,186,1)",pointColor:"rgba(46,179,152,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:e.stats.views.timeline.data}]},r={scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:30,showTooltips:!1,responsive:!0,datasetStroke:!1,datasetStrokeWidth:2,datasetFill:!0};new Chart(o).Line(a,r)}}]);