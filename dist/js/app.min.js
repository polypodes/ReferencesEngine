var utils=new utilsClass,App=angular.module("App",["gridster","ngRoute","ui.sortable","LocalStorageModule","ngUpload","ngAnimate","ngCookies"]).config(["localStorageServiceProvider",function(e){e.setPrefix("_rfktor")}]);App.run(["$rootScope",function(e){e.notify={state:"closed",title:"title",message:"message"}}]),App.directive("focusOn",function(){return function(e,t,o){e.$on(o.focusOn,function(){setTimeout(function(){t[0].focus()},1)})}}),App.directive("file",function(){return{require:"ngModel",restrict:"A",link:function(e,t){t.bind("change",function(){$("input.fileSubmit").trigger("click"),e.$apply()})}}}),App.directive("cover",function(){return{require:"ngModel",restrict:"A",link:function(e,t){t.bind("change",function(){$("input.fileSubmitCover").trigger("click"),e.$apply()})}}}),App.directive("backImg",function(){return function(e,t,o){var r=o.backImg;t.css({"background-image":"url("+r+")","background-size":"cover"})}}),App.factory("Notify",["$rootScope","$timeout",function(e,t){function o(){t.cancel(r),r=t(function(){e.notify.state="closed"},2500)}e.notify.state="closed";var r;return e.notify="opened",function(i,a,s){"close"==i?"question"==e.notify.type&&(e.notify.state="closed"):(e.dialogClick=function(t){e.$broadcast("clickDialog",{choice:t})},e.notify={state:"opened",type:i,title:a,msg:s},"question"!=i&&(o(),$(".info-box").hover(function(){t.cancel(r)},function(){o()})))}}]),App.factory("instantHelp",function(){return function(){$("#helpme").joyride("destroy"),$("#helpme").joyride({tipLocation:"top"}),$("#helpme").joyride()}}),App.factory("NavigationService",["$rootScope",function(e){return e.pageInfos={},{setPageTitle:function(t){e.pageInfos.pageTitle=t}}}]),App.config(["$routeProvider",function(e){e.when("/projects/:project_id?",{templateUrl:"src/views/projects.html",controller:"ProjectsCtrl"}).when("/project/:project_id?",{templateUrl:"src/views/project_add.html",controller:"AddProjectCtrl"}).when("/books/exported",{templateUrl:"src/views/books_exported.html",controller:"BooksExportedCtrl"}).when("/books/:book_id?",{templateUrl:"src/views/books.html",controller:"BooksCtrl"}).when("/book/:book_id?/edit",{templateUrl:"src/views/editor.html",controller:"BookEditorCtrl"}).when("/book/:book_id?",{templateUrl:"src/views/book_add.html",controller:"AddBookCtrl"}).when("/add_project",{templateUrl:"src/views/project_add.html",controller:"AddProjectCtrl"}).when("/add_book",{templateUrl:"src/views/book_add.html",controller:"AddBookCtrl"}).when("/overview",{templateUrl:"src/views/overview.html",controller:"OverviewCtrl"}).when("/settings",{templateUrl:"src/views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/overview"})}]),App.controller("NavCtrl",["$scope","$location","Categories","Notify","instantHelp","$rootScope","NavigationService",function(e,t,o,r,i){e.instantHelp=function(){i("page")},e.mainItems=[{path:"/overview",title:"Vue d'ensemble",icon:"fa-tachometer"},{path:"/settings",title:"Réglages",icon:"fa-cog"}],e.addItems=[{path:"/add_project",title:"Ajouter un projet"},{path:"/add_book",title:"Ajouter un cahier"}],e.preBooksItems=[{path:"/books/exported",title:"Cahiers en ligne"}],e.categoriesItems=o.get(),o.saveLocal(e.categoriesItems),e.isActive=function(e){return e.path==t.path()?!0:!1},e.inputCategory={project:"",book:""},e.addProjectCategory=function(t){if(13===t.which||"click"==t.type&&""!==e.inputCategory.project){var r=0;for(var i in e.categoriesItems.projects)"function"!=typeof e.categoriesItems.projects[i]&&(r=e.categoriesItems.projects[i].id);e.categoriesItems.projects.push({id:parseInt(r)+1,title:e.inputCategory.project,path:"/projects/"+(parseInt(r)+1)}),e.inputCategory.project="",o.saveLocal(e.categoriesItems)}},e.addBookCategory=function(t){if(13===t.which||"click"==t.type&&""!==e.inputCategory.book){var r=0;for(var i in e.categoriesItems.books)"function"!=typeof e.categoriesItems.books[i]&&(r=e.categoriesItems.books[i].id);e.categoriesItems.books.push({id:parseInt(r)+1,title:e.inputCategory.book,path:"/books/"+(parseInt(r)+1)}),e.inputCategory.book="",o.saveLocal(e.categoriesItems)}},e.deleteCategory=function(r,i,a){o.delete(r,i);var s=!1;"projects"==r?(e.categoriesItems.projects[a].path==t.path()&&(s=!0),e.categoriesItems.projects.splice(a,1),s&&t.path("projects/0")):"books"==r&&(e.categoriesItems.books[a].path==t.path()&&(s=!0),e.categoriesItems.books.splice(a,1),s&&t.path("books/0"))};var a=0;e.goBack=function(){window.history.back(),a-=2},e.$on("$routeChangeSuccess",function(){r("close"),e.isPrev=a>=1?!0:!1,a++})}]),App.factory("Categories",["localStorageService",function(e){var t=e.get("categories");return{get:function(){for(var e in t)for(var o in t[e])null!==t[e][o].id&&(t[e][o].path="/"+e+"/"+t[e][o].id);return null===t&&(t={projects:[{id:0,title:"Tous les projets",path:"/projects/"}],books:[{id:0,title:"Tous les cahiers",path:"/books/"}]}),t},saveLocal:function(t){e.set("categories",t)},"delete":function(t,o){o=parseInt(o);var r=e.get("categories");if("projects"==t){for(var i in r.projects)r.projects[i].id==o&&r.projects.splice(i,1);var a=e.get("projects");for(var s in a)a[s].category==o&&(a[s].category=0);e.set("projects",a)}else if("books"==t){for(var i in r.books)r.books[i].id==o&&r.books.splice(i,1);var n=e.get("books");for(var s in n)n[s].category==o&&(n[s].category=0);e.set("books",n)}e.set("categories",r)}}}]),App.controller("OverviewCtrl",["$scope","Projects","Stats","NavigationService",function(e,t,o,r){r.setPageTitle("Vue d'ensemble"),e.pageTitle="Vue d'ensemble",e.stats=o.getForDashboard(),$("canvas#consultations").attr("width",$(".top .graph").width()-40);{var i=document.getElementById("consultations").getContext("2d"),a={labels:e.stats.views.timeline.labels,datasets:[{label:"Consultations",fillColor:"rgba(101,208,186,0.15)",strokeColor:"rgba(101,208,186,1)",pointColor:"rgba(46,179,152,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:e.stats.views.timeline.data}]},s={pointHitDetectionRadius:10,responsive:!0};new Chart(i).Line(a,s)}}]),App.factory("Stats",function(){return{getForDashboard:function(){var e=new Date,t=new Date;t.setDate(t.getDate()-14);for(var o,r=[],i=[];e>=t;){o=e.getDate(),e=new Date(e.setDate(--o));var a=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();r.push(a);var s=Math.floor(301*Math.random());i.push(s)}var n={views:{web:{today:Math.floor(100*Math.random()),yesterday:Math.floor(100*Math.random()),total:Math.floor(2e3*Math.random())+2e3},pdf:{today:Math.floor(100*Math.random()),yesterday:Math.floor(100*Math.random()),total:Math.floor(2e3*Math.random())+2e3},pres:{today:Math.floor(100*Math.random()),yesterday:Math.floor(100*Math.random()),total:Math.floor(2e3*Math.random())+2e3},timeline:{labels:r,data:i}}};return n.views.total={today:n.views.web.today+n.views.pdf.today+n.views.pres.today,yesterday:n.views.web.yesterday+n.views.pdf.yesterday+n.views.pres.yesterday,total:n.views.web.total+n.views.pdf.total+n.views.pres.total},n.views.variations={growth:Math.ceil((n.views.total.today-n.views.total.yesterday)/n.views.total.yesterday*100),new_visits:n.views.total.today-n.views.total.yesterday},n.views.variations.growth>=0&&(n.views.variations.growth="+"+n.views.variations.growth),n.views.variations.new_visits>=0&&(n.views.variations.new_visits="+"+n.views.variations.new_visits),n}}}),App.controller("SettingsCtrl",["$scope","NavigationService","Settings","Notify",function(e,t,o,r){t.setPageTitle("Mes réglages"),e.settings=o.get(),e.saveSettings=function(){o.save(e.settings),r("success","Réglages modifiés","Les réglages ont été modifiés avec succès")}}]),App.factory("Settings",["localStorageService",function(e){return{get:function(){var t=e.get("settings");return t},save:function(t){e.set("settings",t)}}}]),App.controller("AddBookCtrl",["$scope","Projects","Themes","$http","Books","$routeParams","Notify","$location","Categories","NavigationService",function(e,t,o,r,i,a,s,n,c,l){utils.fixVScrollHeight();var p=t.get(0);if(e.categories=c.get(),e.projects=p,e.projects_a=[],e.presentation_type={my_projects:"block",all_projects:"block"},e.themes=o.get(),e.changePresentation=function(t,o){"my_projects"==o?e.presentation_type.my_projects=t:"all_projects"==o&&(e.presentation_type.all_projects=t)},e.addToList=function(t){var o=0;for(var r in e.projects)t==e.projects[r].id&&(o=r);if(e.projects[o].added){e.projects[o].added=!1;for(var i in e.projects_a)e.projects_a[i].id==e.projects[o].id&&e.projects_a.splice(i,1)}else e.projects[o].added=!0,e.projects_a.push(e.projects[o])},e.selectCategory=function(t){e.book.category=e.categories.books[t].id},e.sortableOptions={axis:"y"},e.book={btitle:"Titre du cahier",subtitle:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Optio, eum mollitia voluptatibus. Tempore impedit reprehenderit blanditiis praesentium ab, nemo nisi, quas eaque, voluptatem perferendis quidem, architecto exercitationem saepe facilis illo.",bottomline:"Pour [NOM DU CLIENT] fait le [DATE]",cover:"dist/img/sample.png",date:"date",category:0,theme:e.themes[0],exported:!1},void 0!==a.book_id){if(l.setPageTitle("Modifier un cahier"),e.book=i.getById(a.book_id),e.projects_a=e.book.projects_a,"undefined"==typeof e.book)return n.path("books/0"),s("error","Ce cahier n'existe pas","Le cahier auquel vous tentez d'accéder n'existe pas"),!1}else l.setPageTitle("Ajouter un cahier");for(var u in p)p[u].added=!1;for(var d in e.projects_a)for(var g in e.projects)e.projects_a[d].id==e.projects[g].id&&(e.projects[g].added=!0);e.chooseTheme=function(t){e.book.theme=e.themes[t]},e.chooseTheme(0),e.isUploading=!1,e.uploadImg=function(){e.isUploading=!0},e.uploadCoverComplete=function(t){e.isUploading=!1,"success"==t.status&&(e.book.cover="uploads/files/"+t.fileName)},e.saveBook=function(){var t=e.book;t.projects_a=e.projects_a;var o=i.validate(t);if(o!==!0)return s("error","Erreur lors de l'ajout",o),!1;var r;t.hasOwnProperty("id")?void 0!==a.book_id&&(r=t.id,i.edit(r,t),s("success","Cahier modifié","Le cahier a été modifié avec succès. Vous pouvez effectuer les derniers réglages via la prévisualisation.")):(r=i.add(t),s("success","Cahier ajouté","Le cahier a été ajouté à votre liste. Vous pouvez effectuer les derniers réglages via la prévisualisation.")),n.path("/book/"+r+"/edit")}}]),App.controller("BookEditorCtrl",["$scope","Books","$routeParams","Notify","$location","$http","NavigationService","$cookieStore",function(e,t,o,r,i,a,s,n){function c(){var e="aeiouy".split(""),t="bcdfghjklmnpqrstvwxz".split("");pass="";for(var o=0;5>=o;o++)pass+=o%2===0?e[Math.floor(Math.random()*e.length)]:t[Math.floor(Math.random()*t.length)];return pass}function l(o,i){var s=$.param({file_title:o,data:e.book,overwrite:i});a({url:"templating/export.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:s}).then(function(a){return console.log("response ------"),console.log(a.data.error),console.log(i),"ok"!=a.data.error&&i!==!0?(r("error","Nom déjà utilisé","Ce nom est déjà utilisé, veuillez en choisir un autre !"),!1):(r("success","Votre cahier a été enregistré en ligne","Votre cahier a bien été enregistré en ligne"),e.book.exported=o,e.exportBoxSuccess=!0,t.edit(e.book.id,e.book),void 0)},function(){r("error","Erreur interne","Une erreur s'est produite, contactez un administrateur ... Code d'erreur : REQ02")})}s.setPageTitle("Prévisualiser un cahier"),e.book=t.getById(o.book_id),$("link.template").attr("href","src/templates/"+e.book.theme.src+"/style.css"),e.gridsterOpts={columns:4,rows:4,pushing:!0,floating:!0,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,minColumns:1,minRows:1,maxRows:4,defaultSizeX:1,defaultSizeY:1,mobileBreakPoint:1,resizable:{enabled:!0,handles:"se",start:function(){},resize:function(){},stop:function(){}},draggable:{enabled:!0,start:function(){},drag:function(){},stop:function(){}}},e.saveBook=function(i){var a=t.validate(e.book);if(a!==!0)return r("error","Erreur lors de l'enregistrement",a),!1;if(void 0!==o.book_id&&(t.edit(e.book.id,e.book),i===!0&&r("success","Cahier modifié","Le cahier a été modifié avec succès"),e.book.exported!==!1&&i===!0)){var s=e.book.exported;l(s,!0)}},e.pages=[{text:"cover"},{text:"page 1"},{text:"page 2"},{text:"page 3"},{text:"page 4"}],e.activePage=0;var p=820;setTimeout(function(){p=$(".item").height()+20},500);var u=[0],d=p;u.push(d);for(var g in e.book.projects_a)d+=0!==e.book.projects_a[g].files.length?2*p:p,u.push(d);var f=$(document).height()-p+300;$(".preview").scroll(function(){for(var t=Math.floor($(".preview").scrollTop()+f),o=0;o<u.length-1;o++)t>=u[o]&&t<u[o+1]&&e.activePage!=o&&(e.activePage=o,e.$apply())}),e.exportBox=!1,e.exportBoxSuccess=!1,e.export=function(){if(e.exportBox=!1,e.exportBoxSuccess=!1,e.book.exported){n.put("bTempUrl_"+e.book.id,e.book.exported);var t=$.param({file:e.book.exported+".json"});a({url:"templating/dexport.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t}).then(function(t){"ok"!=t.data.error?r("error","Erreur interne","Une erreur s'est produite, contactez un administrateur ... Code d'erreur : REQ03"):(r("success","Votre cahier a été mis hors ligne","Celui-ci n'est désormais plus accessible aux visiteurs."),e.book.exported=!1,e.saveBook(!1))},function(){r("error","Erreur interne","Une erreur s'est produite, contactez un administrateur ... Code d'erreur : REQ02")})}else e.exportBox=!0,e.bookUrl=n.get("bTempUrl_"+e.book.id)?n.get("bTempUrl_"+e.book.id):c();return e.exportFinal=function(){l(e.bookUrl,!1)},!1},e.closeExportedBox=function(){e.exportBox=!1}}]),App.factory("Books",["localStorageService",function(e){function t(t){null===t&&e.set("books",[])}return{get:function(o){o=parseInt(o);var r=e.get("books"),i=[];if(t(r),0!==o)for(var a in r)r[a].category==o&&i.push(r[a]);else i=r;return i},getById:function(o){o=parseInt(o);var r=e.get("books");t(r);for(var i in r)if(r[i].id==o)return r[i]},saveLocal:function(t){e.set("books",t)},"delete":function(t){t=parseInt(t);var o=e.get("books");for(var r in o)o[r].id==t&&o.splice(r,1);e.set("books",o)},add:function(t){var o=e.get("books"),r=0;for(var i in o)r=o[i].id;return t.id=r+1,o.push(t),e.set("books",o),t.id},edit:function(t,o){t=parseInt(t);var r=e.get("books");for(var i in r)r[i].id==t&&(last_id=i);r[last_id]=o,e.set("books",r)},validate:function(e){var t=150,o=2,r=100,i=50,a=500,s=1,n=[];return"dist/img/sample.png"==e.cover&&n.push("ajoutez une photo de couverture"),e.btitle.length<o&&n.push("titre trop court"),e.btitle.length>r&&n.push("titre trop long"),e.projects_a.length<s&&n.push("ajoutez au moins un projet"),e.date.length>i&&n.push("date trop longue"),e.bottomline.length>t&&n.push("informations complémentaires trop longues"),e.subtitle.length>a&&n.push("description trop longue"),0===n.length?!0:(n=n.join(", "),n=n.charAt(0).toUpperCase()+n.slice(1)+".")}}}]),App.controller("BooksCtrl",["$scope","Books","$routeParams","Notify","Categories","$timeout","$location","NavigationService",function(e,t,o,r,i,a,s,n){n.setPageTitle("Cahiers");for(var c in e.books)e.books[c].visible=!1;a(function(){angular.forEach(e.books,function(t,o){a(function(){e.books[o].visible="visible"},50*o)})},200);var l=i.get();e.cat_id=o.book_id,e.books=t.get(o.book_id),e.sorting="id",e.reverse=!1,e.deleteBook=function(o){r("question","Voulez-vous vraiment supprimer ce cahier ?",{question:"Vous vous apprêtez à supprimer un cahier. Cette action est irréversible. Voulez-vous vraiment faire ça ?",yes:"Oui",no:"non"}),e.$on("clickDialog",function(i,a){if(r("close"),"yes"==a.choice){t.delete(o);for(var s in e.books)e.books[s].id==o&&(e.books.splice(s,1),r("success","Cahier supprimé","Le cahier a été supprimé avec succès"))}})};var p=!1;for(var u in l.books)l.books[u].id==e.cat_id&&(p=u,n.setPageTitle("Cahiers | "+l.books[u].title));return p?(e.cat_name=l.books[e.cat_id].title,e.button_rename=!1,e.toggleRenameInput=function(){e.button_rename=!e.button_rename,e.button_rename===!0&&e.$broadcast("inputRenameShown")},void(e.changeCategoryName=function(t){(13===t.which||"click"==t.type&&""!==e.cat_name)&&(l.books[e.cat_id].title=e.cat_name,i.saveLocal(l),e.toggleRenameInput())})):(s.path("books/0"),r("error","Cette catégorie n'existe pas","La catégorie à laquelle vous tentez d'accéder n'existe pas"),!1)}]),App.controller("BooksExportedCtrl",["$scope","Books","$routeParams","Notify","Categories","NavigationService",function(e,t,o,r,i,a){a.setPageTitle("Cahiers en ligne"),e.categories=i.get(),e.books=t.get(0),e.sorting="id",e.reverse=!1}]),App.factory("exportService",function(){return{"export":function(){return active}}}),App.factory("Themes",function(){return{get:function(){var e=[{id:0,title:"Theme 1",src:"theme1",files:["main.js","jquery"]},{id:1,title:"Theme 2",src:"theme2",files:["main.js","jquery"]},{id:2,title:"Theme 3",src:"theme3",files:["main.js","jquery"]},{id:3,title:"Theme 4",src:"theme4",files:["main.js","jquery"]}];return e}}}),App.controller("AddProjectCtrl",["$scope","Projects","Categories","$routeParams","Notify","$location","NavigationService",function(e,t,o,r,i,a,s){utils.fixBottomBoxHeight(),e.categories=o.get(),e.projects=t.get(0);var n=new Date;if(e.project_data={intro:"Introduction au projet",title:"Titre du projet",date:n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),desc:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci repellendus alias modi praesentium, delectus! Itaque odit ratione sit quisquam quia, cum quaerat ipsam mollitia vero deserunt. Asperiores atque nesciunt quidem.",tags:[],category:0,cover:"dist/img/sample.png",files:[]},e.isUploading=!1,e.uploadImg=function(){e.isUploading=!0},void 0!==r.project_id){if(s.setPageTitle("Modifier un projet"),e.project_data=t.getById(r.project_id),"undefined"==typeof e.project_data)return a.path("projects/0"),i("error","Ce projet n'existe pas","Le projet auquel vous tentez d'accéder n'existe pas"),!1}else s.setPageTitle("Ajouter un projet");e.addProject=function(){var o=e.project_data,s=t.validate(o);if(s!==!0)return i("error","Erreur lors de l'ajout",s),!1;o.hasOwnProperty("id")?void 0!==r.project_id&&(t.edit(r.project_id,o),i("success","Projet modifié","Le projet a été modifié avec succès")):(t.add(o),i("success","Projet ajouté","Le projet a été ajouté avec succès")),a.path("/projects/0")},e.selectCategory=function(t){e.project_data.category=e.categories.projects[t].id},e.addTag=function(t){13===t.which&&""!==e.addedTag&&(e.project_data.tags.push(e.addedTag),e.addedTag="")},e.deleteTag=function(t){return e.project_data.tags.splice(t,1),!1},e.deleteMedia=function(t){e.project_data.files.splice(t,1)},e.uploadCoverComplete=function(t){e.isUploading=!1,"success"==t.status?e.project_data.cover="uploads/files/"+t.fileName:i("error","Erreur d'upload","Image de couverture refusée, verifiez la taille et l'extension de votre fichier.")},e.uploadComplete=function(t){e.isUploading=!1,"success"==t.status?e.project_data.files.push({path:"uploads/files/"+t.fileName}):i("error","Erreur d'upload","Upload refusé, verifiez la taille et l'extension de votre fichier.")}}]),App.factory("Projects",["localStorageService",function(e){function t(t){null===t&&e.set("projects",[])}return{get:function(o){o=parseInt(o);var r=e.get("projects"),i=[];if(t(r),0!==o)for(var a in r)r[a].category==o&&i.push(r[a]);else i=r;return i},getById:function(o){o=parseInt(o);var r=e.get("projects");t(r);for(var i in r)if(r[i].id==o)return r[i]},saveLocal:function(t){e.set("projects",t)},add:function(t){var o=e.get("projects"),r=0;for(var i in o)r=o[i].id;return t.id=r+1,o.push(t),e.set("projects",o),t.id},edit:function(t,o){t=parseInt(t);var r=e.get("projects");for(var i in r)r[i].id==t&&(last_id=i);r[last_id]=o,e.set("projects",r)},"delete":function(t){t=parseInt(t);var o=e.get("projects"),r=e.get("books");for(var i in o)o[i].id==t&&o.splice(i,1);for(var a in r)for(var s in r[a].projects_a)r[a].projects_a[s].id==t&&r[a].projects_a.splice(s,1);e.set("projects",o),e.set("books",r)},validate:function(e){var t=3,o=50,r=1200,i=100,a=100,s=10,n=10,c=[];return"dist/img/sample.png"==e.cover&&c.push("ajoutez une photo de couverture"),e.title.length<t&&c.push("titre trop court"),e.title.length>o&&c.push("titre trop long"),e.desc.length>r&&c.push("description trop longue"),e.intro.length>i&&c.push("introduction trop longue"),e.date.length>a&&c.push("date trop longue"),e.tags.length>s&&c.push("trop de tags (maximum "+s+")"),e.files.length>n&&c.push("trop de fichiers (maximum "+n+")"),0===c.length?!0:(c=c.join(", "),c=c.charAt(0).toUpperCase()+c.slice(1)+".")}}}]),App.controller("ProjectsCtrl",["$scope","Projects","$routeParams","Notify","Categories","$timeout","$location","NavigationService",function(e,t,o,r,i,a,s,n){n.setPageTitle("Projets");for(var c in e.projects)e.projects[c].visible=!1;a(function(){angular.forEach(e.projects,function(t,o){a(function(){e.projects[o].visible="visible"},50*o)})},200);var l=i.get();e.cat_id=o.project_id,e.projects=t.get(o.project_id),e.sorting="id",e.reverse=!1,e.deleteProject=function(o){r("question","Voulez-vous vraiment supprimer ce projet ?",{question:"Vous vous apprêtez à supprimer un projet. Il sera également supprimé de tous les cahiers dans lesquels il a été ajouté. Cette action est irréversible. Voulez-vous vraiment faire ça ?",yes:"Oui",no:"non"}),e.$on("clickDialog",function(i,a){if(r("close"),"yes"==a.choice){t.delete(o);for(var s in e.projects)e.projects[s].id==o&&e.projects.splice(s,1);r("success","Projet supprimé","Le projet a été supprimé avec succès de votre liste ainsi que de tous les cahiers qui le contenaient.")}})};var p=!1;for(var u in l.projects)l.projects[u].id==e.cat_id&&(p=u);return p?(e.cat_name=l.projects[p].title,e.button_rename=!1,e.toggleRenameInput=function(){e.button_rename=!e.button_rename,e.button_rename===!0&&e.$broadcast("inputRenameShown")},void(e.changeCategoryName=function(t){(13===t.which||"click"==t.type&&""!==e.cat_name)&&(l.projects[p].title=e.cat_name,i.saveLocal(l),e.toggleRenameInput())})):(s.path("projects/0"),r("error","Cette catégorie n'existe pas","La catégorie à laquelle vous tentez d'accéder n'existe pas"),!1)}]);